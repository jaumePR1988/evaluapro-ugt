(()=>{var e={};e.id=315,e.ids=[315],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},3058:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>x,tree:()=>c});var s=a(482),r=a(9108),l=a(2563),i=a.n(l),n=a(8300),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);a.d(t,o);let c=["",{children:["admin",{children:["evaluar",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,6327)),"/workspace/evaluapro-ugt/app/admin/evaluar/[id]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,4655)),"/workspace/evaluapro-ugt/app/admin/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,8762)),"/workspace/evaluapro-ugt/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,9361,23)),"next/dist/client/components/not-found-error"]}],d=["/workspace/evaluapro-ugt/app/admin/evaluar/[id]/page.tsx"],u="/admin/evaluar/[id]/page",m={require:a,loadChunk:()=>Promise.resolve()},x=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/admin/evaluar/[id]/page",pathname:"/admin/evaluar/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},4561:(e,t,a)=>{Promise.resolve().then(a.bind(a,6929))},3196:(e,t,a)=>{Promise.resolve().then(a.bind(a,6368))},3582:(e,t,a)=>{Promise.resolve().then(a.bind(a,2079))},8680:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,2583,23)),Promise.resolve().then(a.t.bind(a,6840,23)),Promise.resolve().then(a.t.bind(a,8771,23)),Promise.resolve().then(a.t.bind(a,3225,23)),Promise.resolve().then(a.t.bind(a,9295,23)),Promise.resolve().then(a.t.bind(a,3982,23))},6929:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var s=a(5344),r=a(3729),l=a(2254),i=a(2829),n=a(9224);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=(0,n.Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),c=(0,n.Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var d=a(1498);function u(){let e=(0,l.useParams)(),t=(0,l.useRouter)(),a=e.id,[n,u]=(0,r.useState)(1),[m,x]=(0,r.useState)(null),[p,h]=(0,r.useState)([]),[v,f]=(0,r.useState)([]),[b,g]=(0,r.useState)({eval_company_name:"",eval_position_name:"",eval_affected_people:"",eval_collective_agreement:"",eval_num_groups:6,eval_direct_indirect:"directo",factor_scores:{}}),[j,_]=(0,r.useState)(0),[N,y]=(0,r.useState)("");(0,r.useEffect)(()=>{w()},[a]),(0,r.useEffect)(()=>{P()},[b.factor_scores,b.eval_num_groups]);let w=async()=>{let{data:e}=await i.O.from("requests").select("*").eq("id",a).maybeSingle();e&&(x(e),g(t=>({...t,eval_company_name:e.company_name,eval_position_name:e.position_name,eval_collective_agreement:e.collective_agreement})));let{data:t}=await i.O.from("evaluation_factors").select("*").eq("is_active",!0).order("subfactor_name");t&&h(t);let{data:s}=await i.O.from("group_limits").select("*").order("num_groups").order("group_number");s&&f(s)},P=()=>{let e=Object.values(b.factor_scores).map(Number).reduce((e,t)=>e+t,0);_(e);let t=v.filter(e=>e.num_groups===b.eval_num_groups).find(t=>null===t.max_points?e>=t.min_points:e>=t.min_points&&e<=t.max_points);t&&y(`Grupo ${t.group_number}`)},k=(e,t,a)=>{g(t=>({...t,factor_scores:{...t.factor_scores,[e]:a}}))},C=async()=>{if(!m){alert("Error: No se encontr\xf3 la solicitud");return}try{let{data:e}=await i.O.auth.getUser();if(!e.user){alert("Debe iniciar sesi\xf3n");return}let s={request_id:a,tecnico_id:e.user.id,...b,total_score:j,final_group:N},{data:r,error:l}=await i.O.from("evaluations").insert([s]).select().maybeSingle();if(l)throw l;let n=Object.entries(b.factor_scores).map(([e,t])=>({factorName:e,level:1,points:t}));try{await i.O.functions.invoke("generate-report-google-drive",{body:{evaluationId:r?.id,requestId:a,companyName:m.company_name,positionName:b.eval_position_name||m.position_name,affectedPeople:b.eval_affected_people,collectiveAgreement:b.eval_collective_agreement||m.collective_agreement,factorScores:n,totalScore:j,finalGroup:N,evaluatedBy:e.user.email,evaluationDate:new Date().toLocaleDateString("es-ES")}})}catch(e){console.error("Error generando informe:",e)}alert("Valoraci\xf3n guardada e informe generado exitosamente"),t.push("/admin/dashboard")}catch(e){console.error("Error al guardar:",e),alert("Error al guardar la valoraci\xf3n")}};return m?(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("header",{className:"bg-ugt-red text-white",children:s.jsx("div",{className:"container mx-auto px-4 py-4",children:s.jsx("h1",{className:"text-2xl font-bold",children:"Asistente de Valoraci\xf3n - Manual TLC"})})}),(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center mb-8",children:[(0,s.jsxs)("div",{className:`flex items-center ${n>=1?"text-ugt-red font-bold":"text-gray-400"}`,children:[s.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${n>=1?"bg-ugt-red text-white":"bg-gray-300"}`,children:"1"}),s.jsx("span",{className:"ml-2",children:"Datos Iniciales"})]}),s.jsx("div",{className:"w-16 h-1 bg-gray-300 mx-4"}),(0,s.jsxs)("div",{className:`flex items-center ${n>=2?"text-ugt-red font-bold":"text-gray-400"}`,children:[s.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${n>=2?"bg-ugt-red text-white":"bg-gray-300"}`,children:"2"}),s.jsx("span",{className:"ml-2",children:"Valoraci\xf3n Factores"})]}),s.jsx("div",{className:"w-16 h-1 bg-gray-300 mx-4"}),(0,s.jsxs)("div",{className:`flex items-center ${n>=3?"text-ugt-red font-bold":"text-gray-400"}`,children:[s.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${n>=3?"bg-ugt-red text-white":"bg-gray-300"}`,children:"3"}),s.jsx("span",{className:"ml-2",children:"Resultado Final"})]})]}),1===n&&(0,s.jsxs)("div",{className:"max-w-3xl mx-auto card",children:[s.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Paso 1: Datos Iniciales"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block font-semibold mb-2",children:"Empresa"}),s.jsx("input",{type:"text",className:"input-field",value:b.eval_company_name,onChange:e=>g({...b,eval_company_name:e.target.value})})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block font-semibold mb-2",children:"Puesto a Valorar"}),s.jsx("input",{type:"text",className:"input-field",value:b.eval_position_name,onChange:e=>g({...b,eval_position_name:e.target.value})})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block font-semibold mb-2",children:"Personas Afectadas"}),s.jsx("input",{type:"text",className:"input-field",value:b.eval_affected_people,onChange:e=>g({...b,eval_affected_people:e.target.value}),placeholder:"Ejemplo: 5 trabajadores"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block font-semibold mb-2",children:"Convenio Colectivo"}),s.jsx("input",{type:"text",className:"input-field",value:b.eval_collective_agreement,onChange:e=>g({...b,eval_collective_agreement:e.target.value})})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block font-semibold mb-2",children:"Tipo de Puesto"}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsxs)("label",{className:"flex items-center",children:[s.jsx("input",{type:"radio",value:"directo",checked:"directo"===b.eval_direct_indirect,onChange:e=>g({...b,eval_direct_indirect:e.target.value}),className:"mr-2"}),"Directo (Producci\xf3n)"]}),(0,s.jsxs)("label",{className:"flex items-center",children:[s.jsx("input",{type:"radio",value:"indirecto",checked:"indirecto"===b.eval_direct_indirect,onChange:e=>g({...b,eval_direct_indirect:e.target.value}),className:"mr-2"}),"Indirecto (Administraci\xf3n/T\xe9cnicos)"]})]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block font-semibold mb-2",children:"N\xfamero de Grupos del Convenio"}),(0,s.jsxs)("select",{className:"input-field",value:b.eval_num_groups,onChange:e=>g({...b,eval_num_groups:Number(e.target.value)}),children:[s.jsx("option",{value:6,children:"6 Grupos"}),s.jsx("option",{value:7,children:"7 Grupos"}),s.jsx("option",{value:8,children:"8 Grupos"})]})]})]}),s.jsx("div",{className:"flex justify-end mt-8",children:(0,s.jsxs)("button",{onClick:()=>u(2),className:"btn-primary flex items-center",children:["Continuar ",s.jsx(o,{className:"ml-2",size:20})]})})]}),2===n&&(0,s.jsxs)("div",{className:"max-w-4xl mx-auto card",children:[s.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Paso 2: Valoraci\xf3n de Factores"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"Seleccione el grado correspondiente para cada subfactor seg\xfan el Manual TLC"}),s.jsx("div",{className:"space-y-8",children:(2!==n?[]:p.filter(e=>!e.is_direct_indirect_specific||("indirecto"===b.eval_direct_indirect?e.subfactor_name.includes(".a"):e.subfactor_name.includes(".b"))||!e.subfactor_name.match(/\.[ab]$/))).map(e=>{let t=Object.entries(e.levels_data);return(0,s.jsxs)("div",{className:"border-b pb-6",children:[s.jsx("h3",{className:"font-bold text-lg mb-3 text-ugt-red",children:e.subfactor_name}),s.jsx("div",{className:"space-y-2",children:t.map(([t,a])=>(0,s.jsxs)("label",{className:"flex items-start p-3 border rounded hover:bg-gray-50 cursor-pointer",children:[s.jsx("input",{type:"radio",name:e.subfactor_name,value:t,checked:b.factor_scores[e.subfactor_name]===a.points,onChange:()=>k(e.subfactor_name,Number(t),a.points),className:"mt-1 mr-3"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,s.jsxs)("span",{className:"font-semibold",children:["Grado ",t]}),(0,s.jsxs)("span",{className:"text-ugt-red font-bold",children:[a.points," puntos"]})]}),s.jsx("p",{className:"text-sm text-gray-600",children:a.description})]})]},t))})]},e.factor_id)})}),(0,s.jsxs)("div",{className:"flex justify-between mt-8",children:[(0,s.jsxs)("button",{onClick:()=>u(1),className:"btn-secondary flex items-center",children:[s.jsx(c,{className:"mr-2",size:20})," Atr\xe1s"]}),(0,s.jsxs)("button",{onClick:()=>u(3),className:"btn-primary flex items-center",children:["Ver Resultado ",s.jsx(o,{className:"ml-2",size:20})]})]})]}),3===n&&(0,s.jsxs)("div",{className:"max-w-3xl mx-auto card",children:[s.jsx("h2",{className:"text-2xl font-bold mb-6 text-center",children:"Resultado de la Valoraci\xf3n"}),(0,s.jsxs)("div",{className:"bg-ugt-red text-white p-8 rounded-lg text-center mb-8",children:[s.jsx("p",{className:"text-lg mb-2",children:"Puntuaci\xf3n Total"}),s.jsx("p",{className:"text-6xl font-bold",children:j}),s.jsx("p",{className:"text-2xl mt-4",children:"puntos"})]}),(0,s.jsxs)("div",{className:"bg-green-100 border-2 border-green-500 p-6 rounded-lg text-center mb-8",children:[s.jsx("p",{className:"text-lg text-gray-700 mb-2",children:"Clasificaci\xf3n Final"}),s.jsx("p",{className:"text-4xl font-bold text-green-700",children:N})]}),(0,s.jsxs)("div",{className:"border-t pt-6 mb-6",children:[s.jsx("h3",{className:"font-bold mb-4",children:"Detalle de Puntuaciones"}),s.jsx("div",{className:"grid grid-cols-2 gap-4",children:Object.entries(b.factor_scores).map(([e,t])=>(0,s.jsxs)("div",{className:"flex justify-between border-b pb-2",children:[(0,s.jsxs)("span",{className:"text-sm",children:[e,":"]}),(0,s.jsxs)("span",{className:"font-semibold",children:[t," pts"]})]},e))})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("button",{onClick:()=>u(2),className:"btn-secondary flex items-center",children:[s.jsx(c,{className:"mr-2",size:20})," Modificar"]}),(0,s.jsxs)("button",{onClick:C,className:"btn-primary flex items-center",children:[s.jsx(d.Z,{className:"mr-2",size:20})," Guardar y Generar Informe"]})]})]})]})]}):s.jsx("div",{className:"p-8",children:"Cargando..."})}},6368:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});var s=a(5344),r=a(3729),l=a(2254),i=a(2079);function n({children:e}){let{user:t,loading:a}=(0,i.useAuth)(),n=(0,l.useRouter)();return((0,r.useEffect)(()=>{a||t||n.push("/login")},[t,a,n]),a)?s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-ugt-red mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Verificando autenticaci\xf3n..."})]})}):t?s.jsx(s.Fragment,{children:e}):null}},2079:(e,t,a)=>{"use strict";a.r(t),a.d(t,{AuthProvider:()=>n,useAuth:()=>o});var s=a(5344),r=a(3729),l=a(2829);let i=(0,r.createContext)(void 0);function n({children:e}){let[t,a]=(0,r.useState)(null),[n,o]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async function(){o(!0);try{let{data:{user:e}}=await l.O.auth.getUser();a(e)}finally{o(!1)}})();let{data:{subscription:e}}=l.O.auth.onAuthStateChange((e,t)=>{a(t?.user||null)});return()=>e.unsubscribe()},[]);let c=async(e,t)=>{let{data:a,error:s}=await l.O.auth.signInWithPassword({email:e,password:t});if(s)throw s;return a},d=async(e,t,a)=>{if(!e.endsWith("@ugt.es"))throw Error("Solo se permiten correos del dominio @ugt.es");let{data:s,error:r}=await l.O.auth.signUp({email:e,password:t,options:{data:{full_name:a}}});if(r)throw r;return s.user&&await l.O.from("profiles").insert([{id:s.user.id,email:s.user.email,full_name:a,role:"tecnico",is_active:!0}]),s},u=async()=>{await l.O.auth.signOut()};return s.jsx(i.Provider,{value:{user:t,loading:n,signIn:c,signUp:d,signOut:u},children:e})}function o(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useAuth debe usarse dentro de un AuthProvider");return e}},2829:(e,t,a)=>{"use strict";a.d(t,{O:()=>s});let s=(0,a(6725).eI)("https://ebiqbjgrmjdkwlckmpuj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImViaXFiamdybWpka3dsY2ttcHVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIwMjkyMDUsImV4cCI6MjA3NzYwNTIwNX0.OBCL4RWR3A536ZZrAof_tI5QNDYRJeA5x6HXv-P4d6s")},9224:(e,t,a)=>{"use strict";a.d(t,{Z:()=>i});var s=a(3729),r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),i=(e,t)=>{let a=(0,s.forwardRef)(({color:a="currentColor",size:i=24,strokeWidth:n=2,absoluteStrokeWidth:o,className:c="",children:d,...u},m)=>(0,s.createElement)("svg",{ref:m,...r,width:i,height:i,stroke:a,strokeWidth:o?24*Number(n)/Number(i):n,className:["lucide",`lucide-${l(e)}`,c].join(" "),...u},[...t.map(([e,t])=>(0,s.createElement)(e,t)),...Array.isArray(d)?d:[d]]));return a.displayName=`${e}`,a}},1498:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(9224).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},2254:(e,t,a)=>{e.exports=a(4767)},6327:(e,t,a)=>{"use strict";a.r(t),a.d(t,{$$typeof:()=>l,__esModule:()=>r,default:()=>i});let s=(0,a(6843).createProxy)(String.raw`/workspace/evaluapro-ugt/app/admin/evaluar/[id]/page.tsx`),{__esModule:r,$$typeof:l}=s,i=s.default},4655:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var s=a(5036);let r=(0,a(6843).createProxy)(String.raw`/workspace/evaluapro-ugt/components/ProtectedRoute.tsx`),{__esModule:l,$$typeof:i}=r,n=r.default;function o({children:e}){return s.jsx(n,{children:e})}},8762:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m,metadata:()=>u});var s=a(5036),r=a(8592),l=a.n(r);a(7272);var i=a(6843);let n=(0,i.createProxy)(String.raw`/workspace/evaluapro-ugt/lib/auth-context.tsx`),{__esModule:o,$$typeof:c}=n;n.default;let d=(0,i.createProxy)(String.raw`/workspace/evaluapro-ugt/lib/auth-context.tsx#AuthProvider`);(0,i.createProxy)(String.raw`/workspace/evaluapro-ugt/lib/auth-context.tsx#useAuth`);let u={title:"Eval\xfaaPro UGT - Valoraci\xf3n de Puestos de Trabajo",description:"Plataforma de valoraci\xf3n de puestos de trabajo seg\xfan el Manual TLC para UGT"};function m({children:e}){return s.jsx("html",{lang:"es",children:s.jsx("body",{className:l().className,children:s.jsx(d,{children:e})})})}},7272:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[591],()=>a(3058));module.exports=s})();