(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[956],{2898:function(e,t,a){"use strict";a.d(t,{Z:function(){return c}});var s=a(2265),i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),c=(e,t)=>{let a=(0,s.forwardRef)(({color:a="currentColor",size:c=24,strokeWidth:l=2,absoluteStrokeWidth:o,className:r="",children:d,...u},m)=>(0,s.createElement)("svg",{ref:m,...i,width:c,height:c,stroke:a,strokeWidth:o?24*Number(l)/Number(c):l,className:["lucide",`lucide-${n(e)}`,r].join(" "),...u},[...t.map(([e,t])=>(0,s.createElement)(e,t)),...Array.isArray(d)?d:[d]]));return a.displayName=`${e}`,a}},5883:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(2898).Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])},6245:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(2898).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},3539:function(e,t,a){Promise.resolve().then(a.bind(a,4098))},4098:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var s=a(7437),i=a(2265),n=a(1396),c=a.n(n),l=a(4033),o=a(5922),r=a(8810),d=a(5883),u=a(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let m=(0,u.Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),h=(0,u.Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),x=(0,u.Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);var f=a(6245);function p(){let{user:e,signOut:t}=(0,r.useAuth)(),a=(0,l.useRouter)(),[n,u]=(0,i.useState)(!1),[p,b]=(0,i.useState)("contenido"),[v,j]=(0,i.useState)({quienes_somos_titulo:"",quienes_somos_contenido:"",tecnico_nombre:"",tecnico_titulacion:"",tecnico_email:"",tecnico_telefono:""}),[y,N]=(0,i.useState)([]),[g,_]=(0,i.useState)([]);(0,i.useEffect)(()=>{w()},[]);let w=async()=>{let{data:e}=await o.O.from("site_content").select("*");if(e){let t={};e.forEach(e=>{t[e.content_key]=e.content_value}),j(t)}let{data:t}=await o.O.from("evaluation_factors").select("*").order("subfactor_name");t&&N(t);let{data:a}=await o.O.from("profiles").select("*").order("created_at",{ascending:!1});a&&_(a)},k=async()=>{u(!0);try{for(let[e,t]of Object.entries(v))await o.O.from("site_content").upsert({content_key:e,content_value:t},{onConflict:"content_key"});alert("Contenido guardado exitosamente")}catch(e){alert("Error al guardar contenido")}finally{u(!1)}},C=async(e,t)=>{await o.O.from("evaluation_factors").update({is_active:!t}).eq("factor_id",e),w()},I=async(e,t)=>{await o.O.from("profiles").update({is_active:!t}).eq("id",e),w()},O=async()=>{let{data:e}=await o.O.from("evaluations").select("*");if(e){let t=e.map(e=>[e.id,e.eval_company_name,e.eval_position_name,e.total_score,e.final_group,new Date(e.created_at).toLocaleDateString("es-ES")]),a="ID,Empresa,Puesto,Puntuaci\xf3n Total,Grupo Final,Fecha\n";t.forEach(e=>{a+=e.join(",")+"\n"});let s=new Blob([a],{type:"text/csv"}),i=window.URL.createObjectURL(s),n=document.createElement("a");n.href=i,n.download="evaluaciones_".concat(new Date().toISOString().split("T")[0],".csv"),n.click(),window.URL.revokeObjectURL(i)}},S=async()=>{await t(),a.push("/")};return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("header",{className:"bg-ugt-red text-white",children:(0,s.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"Configuraci\xf3n - Eval\xfaaPro UGT"}),(0,s.jsx)("p",{className:"text-sm opacity-90 mt-1",children:"Gesti\xf3n del sistema"})]}),(0,s.jsxs)("nav",{className:"flex space-x-4",children:[(0,s.jsx)(c(),{href:"/admin/dashboard",className:"hover:underline",children:"Dashboard"}),(0,s.jsx)(c(),{href:"/admin/configuracion",className:"hover:underline font-semibold",children:"Configuraci\xf3n"}),(0,s.jsxs)("button",{onClick:S,className:"hover:underline flex items-center",children:[(0,s.jsx)(d.Z,{size:16,className:"mr-1"})," Salir"]})]})]})})}),(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex space-x-4 mb-6",children:[(0,s.jsxs)("button",{onClick:()=>b("contenido"),className:"px-4 py-2 rounded ".concat("contenido"===p?"bg-ugt-red text-white":"bg-white"),children:[(0,s.jsx)(m,{className:"inline mr-2",size:16}),"Contenido del Sitio"]}),(0,s.jsx)("button",{onClick:()=>b("factores"),className:"px-4 py-2 rounded ".concat("factores"===p?"bg-ugt-red text-white":"bg-white"),children:"Factores TLC"}),(0,s.jsxs)("button",{onClick:()=>b("usuarios"),className:"px-4 py-2 rounded ".concat("usuarios"===p?"bg-ugt-red text-white":"bg-white"),children:[(0,s.jsx)(h,{className:"inline mr-2",size:16}),"Usuarios"]}),(0,s.jsxs)("button",{onClick:()=>b("exportar"),className:"px-4 py-2 rounded ".concat("exportar"===p?"bg-ugt-red text-white":"bg-white"),children:[(0,s.jsx)(x,{className:"inline mr-2",size:16}),"Exportar Datos"]})]}),"contenido"===p&&(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Editar Contenido del Sitio"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block font-semibold mb-2",children:'T\xedtulo "Qui\xe9nes Somos"'}),(0,s.jsx)("input",{type:"text",className:"input-field",value:v.quienes_somos_titulo,onChange:e=>j({...v,quienes_somos_titulo:e.target.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block font-semibold mb-2",children:'Contenido "Qui\xe9nes Somos"'}),(0,s.jsx)("textarea",{className:"input-field",rows:6,value:v.quienes_somos_contenido,onChange:e=>j({...v,quienes_somos_contenido:e.target.value})})]}),(0,s.jsxs)("div",{className:"border-t pt-6",children:[(0,s.jsx)("h3",{className:"font-bold text-lg mb-4",children:"Informaci\xf3n del T\xe9cnico"}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block font-semibold mb-2",children:"Nombre"}),(0,s.jsx)("input",{type:"text",className:"input-field",value:v.tecnico_nombre,onChange:e=>j({...v,tecnico_nombre:e.target.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block font-semibold mb-2",children:"Titulaci\xf3n"}),(0,s.jsx)("input",{type:"text",className:"input-field",value:v.tecnico_titulacion,onChange:e=>j({...v,tecnico_titulacion:e.target.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block font-semibold mb-2",children:"Email"}),(0,s.jsx)("input",{type:"email",className:"input-field",value:v.tecnico_email,onChange:e=>j({...v,tecnico_email:e.target.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block font-semibold mb-2",children:"Tel\xe9fono"}),(0,s.jsx)("input",{type:"tel",className:"input-field",value:v.tecnico_telefono,onChange:e=>j({...v,tecnico_telefono:e.target.value})})]})]})]}),(0,s.jsxs)("button",{onClick:k,disabled:n,className:"btn-primary flex items-center",children:[(0,s.jsx)(f.Z,{className:"mr-2",size:20}),n?"Guardando...":"Guardar Cambios"]})]})]}),"factores"===p&&(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Gesti\xf3n de Factores TLC"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"Activar o desactivar factores de evaluaci\xf3n"}),(0,s.jsx)("div",{className:"space-y-3",children:y.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold",children:e.subfactor_name}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:e.is_direct_indirect_specific?e.subfactor_name.includes(".a")?"Indirecto":"Directo":"Com\xfan"})]}),(0,s.jsx)("button",{onClick:()=>C(e.factor_id,e.is_active),className:"px-4 py-2 rounded ".concat(e.is_active?"bg-green-500 text-white":"bg-gray-300"),children:e.is_active?"Activo":"Inactivo"})]},e.factor_id))})]}),"usuarios"===p&&(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Gesti\xf3n de Usuarios T\xe9cnicos"}),(0,s.jsx)("div",{className:"space-y-3",children:g.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold",children:e.full_name}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:e.email}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["Rol: ",e.role]})]}),(0,s.jsx)("button",{onClick:()=>I(e.id,e.is_active),className:"px-4 py-2 rounded ".concat(e.is_active?"bg-green-500 text-white":"bg-gray-300"),children:e.is_active?"Activo":"Inactivo"})]},e.id))})]}),"exportar"===p&&(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Exportar Datos"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"Descargue los datos del sistema en formato CSV"}),(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)("button",{onClick:O,className:"btn-primary flex items-center",children:[(0,s.jsx)(x,{className:"mr-2",size:20}),"Exportar Valoraciones a CSV"]})})]})]})]})}},8810:function(e,t,a){"use strict";a.r(t),a.d(t,{AuthProvider:function(){return l},useAuth:function(){return o}});var s=a(7437),i=a(2265),n=a(5922);let c=(0,i.createContext)(void 0);function l(e){let{children:t}=e,[a,l]=(0,i.useState)(null),[o,r]=(0,i.useState)(!0);(0,i.useEffect)(()=>{!async function(){r(!0);try{let{data:{user:e}}=await n.O.auth.getUser();l(e)}finally{r(!1)}}();let{data:{subscription:e}}=n.O.auth.onAuthStateChange((e,t)=>{l((null==t?void 0:t.user)||null)});return()=>e.unsubscribe()},[]);let d=async(e,t)=>{let{data:a,error:s}=await n.O.auth.signInWithPassword({email:e,password:t});if(s)throw s;return a},u=async(e,t,a)=>{if(!e.endsWith("@ugt.es"))throw Error("Solo se permiten correos del dominio @ugt.es");let{data:s,error:i}=await n.O.auth.signUp({email:e,password:t,options:{data:{full_name:a}}});if(i)throw i;return s.user&&await n.O.from("profiles").insert([{id:s.user.id,email:s.user.email,full_name:a,role:"tecnico",is_active:!0}]),s},m=async()=>{await n.O.auth.signOut()};return(0,s.jsx)(c.Provider,{value:{user:a,loading:o,signIn:d,signUp:u,signOut:m},children:t})}function o(){let e=(0,i.useContext)(c);if(void 0===e)throw Error("useAuth debe usarse dentro de un AuthProvider");return e}},5922:function(e,t,a){"use strict";a.d(t,{O:function(){return s}});let s=(0,a(359).eI)("https://ebiqbjgrmjdkwlckmpuj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImViaXFiamdybWpka3dsY2ttcHVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIwMjkyMDUsImV4cCI6MjA3NzYwNTIwNX0.OBCL4RWR3A536ZZrAof_tI5QNDYRJeA5x6HXv-P4d6s")},1396:function(e,t,a){e.exports=a(5250)},4033:function(e,t,a){e.exports=a(5313)}},function(e){e.O(0,[673,250,971,938,744],function(){return e(e.s=3539)}),_N_E=e.O()}]);