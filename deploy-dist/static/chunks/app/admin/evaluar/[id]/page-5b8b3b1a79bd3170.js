(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[315],{2898:function(e,a,s){"use strict";s.d(a,{Z:function(){return n}});var t=s(2265),l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),n=(e,a)=>{let s=(0,t.forwardRef)(({color:s="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:c,className:o="",children:d,...m},u)=>(0,t.createElement)("svg",{ref:u,...l,width:n,height:n,stroke:s,strokeWidth:c?24*Number(i)/Number(n):i,className:["lucide",`lucide-${r(e)}`,o].join(" "),...m},[...a.map(([e,a])=>(0,t.createElement)(e,a)),...Array.isArray(d)?d:[d]]));return s.displayName=`${e}`,s}},6245:function(e,a,s){"use strict";s.d(a,{Z:function(){return t}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,s(2898).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},1832:function(e,a,s){Promise.resolve().then(s.bind(s,6296))},6296:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return m}});var t=s(7437),l=s(2265),r=s(4033),n=s(5922),i=s(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let c=(0,i.Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),o=(0,i.Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var d=s(6245);function m(){let e=(0,r.useParams)(),a=(0,r.useRouter)(),s=e.id,[i,m]=(0,l.useState)(1),[u,x]=(0,l.useState)(null),[p,h]=(0,l.useState)([]),[f,b]=(0,l.useState)([]),[v,j]=(0,l.useState)({eval_company_name:"",eval_position_name:"",eval_affected_people:"",eval_collective_agreement:"",eval_num_groups:6,eval_direct_indirect:"directo",factor_scores:{}}),[_,g]=(0,l.useState)(0),[N,y]=(0,l.useState)("");(0,l.useEffect)(()=>{w()},[s]),(0,l.useEffect)(()=>{k()},[v.factor_scores,v.eval_num_groups]);let w=async()=>{let{data:e}=await n.O.from("requests").select("*").eq("id",s).maybeSingle();e&&(x(e),j(a=>({...a,eval_company_name:e.company_name,eval_position_name:e.position_name,eval_collective_agreement:e.collective_agreement})));let{data:a}=await n.O.from("evaluation_factors").select("*").eq("is_active",!0).order("subfactor_name");a&&h(a);let{data:t}=await n.O.from("group_limits").select("*").order("num_groups").order("group_number");t&&b(t)},k=()=>{let e=Object.values(v.factor_scores).map(Number).reduce((e,a)=>e+a,0);g(e);let a=f.filter(e=>e.num_groups===v.eval_num_groups).find(a=>null===a.max_points?e>=a.min_points:e>=a.min_points&&e<=a.max_points);a&&y("Grupo ".concat(a.group_number))},C=(e,a,s)=>{j(a=>({...a,factor_scores:{...a.factor_scores,[e]:s}}))},I=async()=>{if(!u){alert("Error: No se encontr\xf3 la solicitud");return}try{let{data:e}=await n.O.auth.getUser();if(!e.user){alert("Debe iniciar sesi\xf3n");return}let t={request_id:s,tecnico_id:e.user.id,...v,total_score:_,final_group:N},{data:l,error:r}=await n.O.from("evaluations").insert([t]).select().maybeSingle();if(r)throw r;let i=Object.entries(v.factor_scores).map(e=>{let[a,s]=e;return{factorName:a,level:1,points:s}});try{await n.O.functions.invoke("generate-report-google-drive",{body:{evaluationId:null==l?void 0:l.id,requestId:s,companyName:u.company_name,positionName:v.eval_position_name||u.position_name,affectedPeople:v.eval_affected_people,collectiveAgreement:v.eval_collective_agreement||u.collective_agreement,factorScores:i,totalScore:_,finalGroup:N,evaluatedBy:e.user.email,evaluationDate:new Date().toLocaleDateString("es-ES")}})}catch(e){console.error("Error generando informe:",e)}alert("Valoraci\xf3n guardada e informe generado exitosamente"),a.push("/admin/dashboard")}catch(e){console.error("Error al guardar:",e),alert("Error al guardar la valoraci\xf3n")}};return u?(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)("header",{className:"bg-ugt-red text-white",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Asistente de Valoraci\xf3n - Manual TLC"})})}),(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center mb-8",children:[(0,t.jsxs)("div",{className:"flex items-center ".concat(i>=1?"text-ugt-red font-bold":"text-gray-400"),children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center ".concat(i>=1?"bg-ugt-red text-white":"bg-gray-300"),children:"1"}),(0,t.jsx)("span",{className:"ml-2",children:"Datos Iniciales"})]}),(0,t.jsx)("div",{className:"w-16 h-1 bg-gray-300 mx-4"}),(0,t.jsxs)("div",{className:"flex items-center ".concat(i>=2?"text-ugt-red font-bold":"text-gray-400"),children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center ".concat(i>=2?"bg-ugt-red text-white":"bg-gray-300"),children:"2"}),(0,t.jsx)("span",{className:"ml-2",children:"Valoraci\xf3n Factores"})]}),(0,t.jsx)("div",{className:"w-16 h-1 bg-gray-300 mx-4"}),(0,t.jsxs)("div",{className:"flex items-center ".concat(i>=3?"text-ugt-red font-bold":"text-gray-400"),children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center ".concat(i>=3?"bg-ugt-red text-white":"bg-gray-300"),children:"3"}),(0,t.jsx)("span",{className:"ml-2",children:"Resultado Final"})]})]}),1===i&&(0,t.jsxs)("div",{className:"max-w-3xl mx-auto card",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Paso 1: Datos Iniciales"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block font-semibold mb-2",children:"Empresa"}),(0,t.jsx)("input",{type:"text",className:"input-field",value:v.eval_company_name,onChange:e=>j({...v,eval_company_name:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block font-semibold mb-2",children:"Puesto a Valorar"}),(0,t.jsx)("input",{type:"text",className:"input-field",value:v.eval_position_name,onChange:e=>j({...v,eval_position_name:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block font-semibold mb-2",children:"Personas Afectadas"}),(0,t.jsx)("input",{type:"text",className:"input-field",value:v.eval_affected_people,onChange:e=>j({...v,eval_affected_people:e.target.value}),placeholder:"Ejemplo: 5 trabajadores"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block font-semibold mb-2",children:"Convenio Colectivo"}),(0,t.jsx)("input",{type:"text",className:"input-field",value:v.eval_collective_agreement,onChange:e=>j({...v,eval_collective_agreement:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block font-semibold mb-2",children:"Tipo de Puesto"}),(0,t.jsxs)("div",{className:"flex space-x-4",children:[(0,t.jsxs)("label",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"radio",value:"directo",checked:"directo"===v.eval_direct_indirect,onChange:e=>j({...v,eval_direct_indirect:e.target.value}),className:"mr-2"}),"Directo (Producci\xf3n)"]}),(0,t.jsxs)("label",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"radio",value:"indirecto",checked:"indirecto"===v.eval_direct_indirect,onChange:e=>j({...v,eval_direct_indirect:e.target.value}),className:"mr-2"}),"Indirecto (Administraci\xf3n/T\xe9cnicos)"]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block font-semibold mb-2",children:"N\xfamero de Grupos del Convenio"}),(0,t.jsxs)("select",{className:"input-field",value:v.eval_num_groups,onChange:e=>j({...v,eval_num_groups:Number(e.target.value)}),children:[(0,t.jsx)("option",{value:6,children:"6 Grupos"}),(0,t.jsx)("option",{value:7,children:"7 Grupos"}),(0,t.jsx)("option",{value:8,children:"8 Grupos"})]})]})]}),(0,t.jsx)("div",{className:"flex justify-end mt-8",children:(0,t.jsxs)("button",{onClick:()=>m(2),className:"btn-primary flex items-center",children:["Continuar ",(0,t.jsx)(c,{className:"ml-2",size:20})]})})]}),2===i&&(0,t.jsxs)("div",{className:"max-w-4xl mx-auto card",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Paso 2: Valoraci\xf3n de Factores"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:"Seleccione el grado correspondiente para cada subfactor seg\xfan el Manual TLC"}),(0,t.jsx)("div",{className:"space-y-8",children:(2!==i?[]:p.filter(e=>!e.is_direct_indirect_specific||("indirecto"===v.eval_direct_indirect?e.subfactor_name.includes(".a"):e.subfactor_name.includes(".b"))||!e.subfactor_name.match(/\.[ab]$/))).map(e=>{let a=Object.entries(e.levels_data);return(0,t.jsxs)("div",{className:"border-b pb-6",children:[(0,t.jsx)("h3",{className:"font-bold text-lg mb-3 text-ugt-red",children:e.subfactor_name}),(0,t.jsx)("div",{className:"space-y-2",children:a.map(a=>{let[s,l]=a;return(0,t.jsxs)("label",{className:"flex items-start p-3 border rounded hover:bg-gray-50 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",name:e.subfactor_name,value:s,checked:v.factor_scores[e.subfactor_name]===l.points,onChange:()=>C(e.subfactor_name,Number(s),l.points),className:"mt-1 mr-3"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,t.jsxs)("span",{className:"font-semibold",children:["Grado ",s]}),(0,t.jsxs)("span",{className:"text-ugt-red font-bold",children:[l.points," puntos"]})]}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:l.description})]})]},s)})})]},e.factor_id)})}),(0,t.jsxs)("div",{className:"flex justify-between mt-8",children:[(0,t.jsxs)("button",{onClick:()=>m(1),className:"btn-secondary flex items-center",children:[(0,t.jsx)(o,{className:"mr-2",size:20})," Atr\xe1s"]}),(0,t.jsxs)("button",{onClick:()=>m(3),className:"btn-primary flex items-center",children:["Ver Resultado ",(0,t.jsx)(c,{className:"ml-2",size:20})]})]})]}),3===i&&(0,t.jsxs)("div",{className:"max-w-3xl mx-auto card",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold mb-6 text-center",children:"Resultado de la Valoraci\xf3n"}),(0,t.jsxs)("div",{className:"bg-ugt-red text-white p-8 rounded-lg text-center mb-8",children:[(0,t.jsx)("p",{className:"text-lg mb-2",children:"Puntuaci\xf3n Total"}),(0,t.jsx)("p",{className:"text-6xl font-bold",children:_}),(0,t.jsx)("p",{className:"text-2xl mt-4",children:"puntos"})]}),(0,t.jsxs)("div",{className:"bg-green-100 border-2 border-green-500 p-6 rounded-lg text-center mb-8",children:[(0,t.jsx)("p",{className:"text-lg text-gray-700 mb-2",children:"Clasificaci\xf3n Final"}),(0,t.jsx)("p",{className:"text-4xl font-bold text-green-700",children:N})]}),(0,t.jsxs)("div",{className:"border-t pt-6 mb-6",children:[(0,t.jsx)("h3",{className:"font-bold mb-4",children:"Detalle de Puntuaciones"}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-4",children:Object.entries(v.factor_scores).map(e=>{let[a,s]=e;return(0,t.jsxs)("div",{className:"flex justify-between border-b pb-2",children:[(0,t.jsxs)("span",{className:"text-sm",children:[a,":"]}),(0,t.jsxs)("span",{className:"font-semibold",children:[s," pts"]})]},a)})})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("button",{onClick:()=>m(2),className:"btn-secondary flex items-center",children:[(0,t.jsx)(o,{className:"mr-2",size:20})," Modificar"]}),(0,t.jsxs)("button",{onClick:I,className:"btn-primary flex items-center",children:[(0,t.jsx)(d.Z,{className:"mr-2",size:20})," Guardar y Generar Informe"]})]})]})]})]}):(0,t.jsx)("div",{className:"p-8",children:"Cargando..."})}},5922:function(e,a,s){"use strict";s.d(a,{O:function(){return t}});let t=(0,s(359).eI)("https://ebiqbjgrmjdkwlckmpuj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImViaXFiamdybWpka3dsY2ttcHVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIwMjkyMDUsImV4cCI6MjA3NzYwNTIwNX0.OBCL4RWR3A536ZZrAof_tI5QNDYRJeA5x6HXv-P4d6s")},4033:function(e,a,s){e.exports=s(5313)}},function(e){e.O(0,[673,971,938,744],function(){return e(e.s=1832)}),_N_E=e.O()}]);